// constants
const SERVER_NAME = '\x1b[34m[Mihai-Server]\x1b[0m';
// const err = console.log("DB conn \x1b[31mfailed!\x1b[0m");  // ill use later
const PORT = 8080;  // for some reason if this port is not available and server is not starting, it can be changed from here as it is a global variable 
const MongoClient = require('mongodb').MongoClient;
const urlDB = "mongodb+srv://mihaiapp:MyDBpassMihai123@mihai.ch81p.mongodb.net/mydb?retryWrites=true&w=majority";
const http = require('http');
const express = require('express');     // 1/2 required to get the server
const app = express();                  //  2/2

//|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?//
//|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|   danger - testing grounds     LOL ?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?//
//|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?//
var DBresults = undefined;

MongoClient.connect(urlDB, function(err, db) {
  if (err) throw err;
  var dbo = db.db("mydb");
  dbo.collection("users").find().toArray(function(err, result) {
    if (err) throw err;
    DBresults = result;
    db.close();
  });
});
//|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?//
//|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?   danger - testing grounds     LOL ?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?//
//|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?|?//


// use res.render to load up an ejs view file //
// data page
app.get('/data', function(req, res) {
  var mascots = DBresults;
  var tagline = "No programming concept is complete without a cute animal mascot.";  // local variable
  console.log("Rendering \x1b[34m[data.ejs]\x1b[0m");
  res.render('pages/data.ejs', {
    mascots: mascots,
    tagline: tagline
  });
});
// about page
app.get('/about', function(req, res) {
  console.log("Rendering \x1b[34m[about.ejs]\x1b[0m");
  res.render('pages/about.ejs');
});


app.set('view engine', 'ejs'); // set the view engine to ejs


MongoClient.connect(urlDB, function(err, db) {
    if (err) throw err;
    var dbo = db.db("mydb");
    console.log("DB conn \x1b[32msuccessful!\x1b[0m");
    db.close();
});

console.log();
app.listen(PORT);
console.log(SERVER_NAME+'is listening on port \x1b[32m'+PORT+'\x1b[0m.');